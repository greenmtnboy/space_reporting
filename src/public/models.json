[
  {
    "id": "engine.preql",
    "name": "engine",
    "contents": "#auto-generated datasource from table/view engines\nimport std.metric;\nimport std.color;\nimport etl;\n\nkey name string; # name of engine\nproperty name.manufacturer string; # manufacturer of the engine\nproperty name.family string; # engine family, a loosely defined grouping\nproperty name.alt_name string; # alternative name of the engine\nkey oxidizer string; # type of oxidizer used\nkey fuel string; # type of fuel used\nproperty name.mass float; # mass in kg, loaded for solids only\nproperty name.mflag string; # mass flag for additional information\nproperty name.impulse int; # total impulse in kNs, mostly for solids\nproperty name.impflag string; # impulse flag for additional information\nproperty name.thrust numeric::kn; # typical thrust in kilonewtons (kN)\nproperty name.tflag string; # thrust flag for additional information\nproperty name.isp float; # typical specific impulse in seconds, vacuum Isp where available\nproperty name.ispflag string; # isp flag for additional information\nproperty name.duration float; # typical burn duration in seconds\nproperty name.durflag string; # duration flag for additional information\nproperty name.chambers int; # number of engine chambers per engine\nproperty name.date string; # date of first flight\nproperty name.usage string; # example of usage, includes stage number in brackets\nkey group string; # general grouping of engines\n\n\nauto group_hex_color <- CASE\n        # Top tier (very high volume, maximal contrast)\n        WHEN COALESCE(group, 'Unspecified') = 'NTO/UDMH'     THEN '#D62728' # strong red\n        WHEN COALESCE(group, 'Unspecified') = 'LOX/Kero'     THEN '#1F77B4' # strong blue\n        WHEN COALESCE(group, 'Unspecified') = 'NA/Kero'      THEN '#FF7F0E' # orange\n        WHEN COALESCE(group, 'Unspecified') = 'NA/UDMH'      THEN '#9467BD' # purple\n        WHEN COALESCE(group, 'Unspecified') = 'NA/AA'        THEN '#2CA02C' # green\n\n        # High\u2013mid tier\n        WHEN COALESCE(group, 'Unspecified') = 'LOX/Alcohol'  THEN '#17BECF' # cyan\n        WHEN COALESCE(group, 'Unspecified') = 'LOX/LH2'       THEN '#8C564B' # brown\n        WHEN COALESCE(group, 'Unspecified') = 'NTO/Hyd'       THEN '#E377C2' # pink\n        WHEN COALESCE(group, 'Unspecified') = 'NA/Amine'     THEN '#BCBD22' # olive\n        WHEN COALESCE(group, 'Unspecified') = 'Hybrid'       THEN '#7F7F7F' # dark gray\n\n        # Mid tier\n        WHEN COALESCE(group, 'Unspecified') = 'LOX/UDMH'     THEN '#AEC7E8' # light blue\n        WHEN COALESCE(group, 'Unspecified') = 'LOX/NH3'      THEN '#98DF8A' # light green\n        WHEN COALESCE(group, 'Unspecified') = 'NA/Turps'     THEN '#FFBB78' # light orange\n        WHEN COALESCE(group, 'Unspecified') = 'NA/UDMH'      THEN '#C5B0D5' # light purple\n        WHEN COALESCE(group, 'Unspecified') = 'Green'        THEN '#C49C94' # muted green-brown\n\n        # Low volume / tail\n        WHEN COALESCE(group, 'Unspecified') = 'H2O2/Kero'    THEN '#DBDB8D'\n        WHEN COALESCE(group, 'Unspecified') = 'LOX/Methane'  THEN '#F7B6D2'\n        WHEN COALESCE(group, 'Unspecified') = 'MonoHyd'      THEN '#C7C7C7'\n        WHEN COALESCE(group, 'Unspecified') = 'N2'           THEN '#E0E0E0'\n        WHEN COALESCE(group, 'Unspecified') = 'LOX/Propane'  THEN '#EEEEEE'\n\n        # Electric / rare / unspecified\n        WHEN COALESCE(group, 'Unspecified') = 'EP'           THEN '#BDBDBD'\n        ELSE '#BDBDBD'\n    END;\n\nroot datasource engines_raw (\n    Name: name,\n    Manufacturer: manufacturer,\n    Family: family,\n    Alt_name: alt_name,\n    Oxidizer: oxidizer,\n    Fuel: fuel,\n    Mass: ?mass,\n    MFlag: ?mflag,\n    Impulse: ?impulse,\n    ImpFlag: ?impflag,\n    Thrust: ?thrust,\n    TFlag: ?tflag,\n    Isp: ?isp,\n    IspFlag: ?ispflag,\n    Duration: ?duration,\n    DurFlag: ?durflag,\n    Chambers: ?chambers,\n    Date: date,\n    Usage: usage,\n    Group: group,\n    data_update_date: data_updated_through\n    )\ngrain (name)\nfile `ingest_engine.py`\nfreshness by data_updated_through;\n\n\ndatasource engine (\n    name,\n    manufacturer,\n    family,\n    alt_name,\n    oxidizer,\n    fuel,\n    ?mass,\n    ?mflag,\n    ?impulse,\n    ?impflag,\n    ?thrust,\n    ?tflag,\n    ?isp,\n    ?ispflag,\n    ?duration,\n    ?durflag,\n    ?chambers,\n    date,\n    usage,\n    group,\n    data_updated_through\n    )\ngrain (name)\nfile `https://storage.googleapis.com/trilogy_public_models/duckdb/launch_report/engine.parquet`:`gcs://trilogy_public_models/duckdb/launch_report/engine.parquet`\nfreshness by data_updated_through;\n\n",
    "type": "preql"
  },
  {
    "id": "etl.preql",
    "name": "etl",
    "contents": "# shared concepts\nkey data_updated_through datetime; # date when the data was last updated\n\ndef extract_date(col)-> CASE \n        WHEN TRIM(REGEXP_EXTRACT(REPLACE(col, '?', ''), '(\\d{4}\\s+[A-Za-z]{3}\\s+\\d{1,2})', 1)) IS NOT NULL \n             AND LEN(TRIM(REGEXP_EXTRACT(REPLACE(col, '?', ''), '(\\d{4}\\s+[A-Za-z]{3}\\s+\\d{1,2})', 1))) > 0\n        THEN parse_time(\n            TRIM(REGEXP_EXTRACT(REPLACE(col, '?', ''), '(\\d{4}\\s+[A-Za-z]{3}\\s+\\d{1,2})', 1)),\n            '%Y %b %d'\n        )\n        ELSE NULL\n    END::date;\n\n    #4A6CFF",
    "type": "preql"
  },
  {
    "id": "launch.preql",
    "name": "launch",
    "contents": "\nimport etl;\n\nkey launch_tag string; # Each rocket launch in the database is labelled with a unique designation. For successful orbital launches, we use the International Designation (also called the COSPAR designation, after the Committee on Space Research which adopted the system.) For other launches, I use a variation on that scheme of my own design. I introduce the generalized concept of `launch designation' to include the International/COSPAR designation and other similar schemes. The term `piece designation' is also introduced to generalize the per-piece (per-cataloged-object) international designation.\n\n# restrict imports in the launch namespacespace to those that have had launches\nimport platform as platform;\nimport vehicle as vehicle;\nimport sites as site;\nimport organization as org;\nimport organization as state;\n\nmerge org.state_code into state.code;\n\nproperty launch_tag.launch_jd float; # float of launch date on julian calendar\n# property <launch_tag>.launch_date string;\nproperty launch_tag.flight_id string; #  an identifier for the particular launch, for example the serial number of the launch vehicle or the mission number or name assigned by the launch agency.\nproperty launch_tag.flight string; #  additional identifers for the launch. For orbital flights, at least one flight/mission/flightode is usually the name of the payload. Some launches have a lot of different designations. I haven't been fully consistent about which name goes in which of the Flight, Mission, FlightCode fields, although usually names in a specific series are in the same column.\nproperty launch_tag.mission string; #  additional identifers for the launch. For orbital flights, at least one flight/mission/flightode is usually the name of the payload. Some launches have a lot of different designations. I haven't been fully consistent about which name goes in which of the Flight, Mission, FlightCode fields, although usually names in a specific series are in the same column.\nproperty launch_tag.flight_code string; #  additional identifers for the launch. For orbital flights, at least one flight/mission/flightode is usually the name of the payload. Some launches have a lot of different designations. I haven't been fully consistent about which name goes in which of the Flight, Mission, FlightCode fields, although usually names in a specific series are in the same column.\n# property <launch_tag>.launch_site string;\nproperty launch_tag.launch_pad string;\nproperty launch_tag.ascent_site string;\nproperty launch_tag.ascent_pad string;\nproperty launch_tag.apogee int; # the highest altitude actually reached, in km. This field may be omitted for orbital launches. In many cases for non-orbital launches the value is a guess based on known capabilities of the launch vehicle, so only values with no appended question-mark should be taken as accurate.\nproperty launch_tag.apo_flag string;\nproperty launch_tag.range string; # the range in km measured along the curved surface of the Earth between launch site and impact site, for a suborbital launch. I have only recently added this field and very few entries are filled in.\nproperty launch_tag.range_flag string;\nproperty launch_tag.dest string;\nproperty launch_tag.orb_pay float; # payload in tonnes delivered to orbit\nkey _launch_code string;\nproperty launch_tag.fail_code string; #The launch failure code. This field is reserved for future use. For failed launches, it will encode the nature of the failure. \nproperty launch_tag.category string; # For non-orbital launches: Type of flight. Not necessarily a rigorous set of designations. For orbital launches: Launch profile code. This records what the target orbit type was, how many upper stages where left in orbit, and what kind of debris mitigation manuever was carried out for them, if any. The codes are explained in the launch profile code part of the definitions section. \nproperty launch_tag.lt_cite string; #  this citation is the primary reference for the existence of the launch and for the given launch time. See the Refs file. \"Wire\" means that the time was taken from wire service stories, internet news sites or live launch broadcasts. I've been more careful with recording a specific source where the launch time was hard to find. \nproperty launch_tag.cite string; # Additional citation of interest, for example reference for which launch pad was used, etc. \nproperty launch_tag.notes string;\nproperty launch_tag.orgs string;\nproperty launch_tag._split_orgs <- split(orgs,'/');\nproperty launch_tag.first_org <- _split_orgs[1];\n\nMERGE first_org into org.code;\n\nproperty launch_tag.launch_date <- date_add('1900-01-01'::date,day,CAST((CAST(launch_jd AS float) - 2415021) AS int));\nproperty success_flag <- CASE\n\tWHEN _launch_code = '' THEN null\n\tWHEN len(_launch_code) > 1 THEN substring(_launch_code,2,len(_launch_code) - 1)\n\tELSE null\nEND; # F|E|O for most cases; F is failure. E is pad issue.\nproperty was_complete_success <- CASE\n\tWHEN success_flag = 'S' THEN True\n\tELSE False\nEND; #whether the mission was a complete sucess\nproperty launch_type_code <- CASE\n\tWHEN (_launch_code is null or _launch_code = '') THEN null\n\tELSE substring(_launch_code,1,1)\nEND; # O - Orbital | M - Military Missile | T - Test Rocket | A - Atmospheric Rocket | S - Suborbital Rocket | D - Deep Space | H - High-altitude Sounding | R - Reentry Test | X - Launch from other world | Y - Suborbital Spaceplane\nproperty launch_type_label <- CASE\n\tWHEN launch_type_code is null THEN null\n\tWHEN launch_type_code = 'O' THEN 'Orbital'\n\tWHEN launch_type_code = 'M' THEN 'Military Missile'\n\tWHEN launch_type_code = 'T' THEN 'Test Rocket'\n\tWHEN launch_type_code = 'A' THEN 'Atmospheric Rocket'\n\tWHEN launch_type_code = 'S' THEN 'Suborbital Rocket'\n\tWHEN launch_type_code = 'D' THEN 'Deep Space'\n\tWHEN launch_type_code = 'H' THEN 'High-altitude Sounding'\n\tWHEN launch_type_code = 'R' THEN 'Reentry Test'\n\tWHEN launch_type_code = 'X' THEN 'Launch from other world'\n\tWHEN launch_type_code = 'Y' THEN 'Suborbital Spaceplane'\n\tELSE launch_type_code\nEND; # interpret the first letter of the existing launch_code into a readable label. Kept as launch_code_label to avoid shadowing the original launch_code property\nmetric launch_count <- count(launch_tag); # count of launches\nkey orbit_code <- split(category,' ')[2]; # Orbit code definitions (3-letter codes, capitalized):\n# DSO - Deep Space Orbit: Earth orbit with apogee beyond 150,000 km\n# EEO - Earth Escape Orbit\n# GEO - Direct Geosynchronous insertion\n# GTO - Geosynchronous Transfer Orbit\n# HEO - Highly Elliptical Orbit (excludes MTO, MOL, DSO)\n# ISS - International Space Station\n# LEO - Low Earth Orbit (excludes SSO, LSS, ISS)\n# LSS - LEO Space Station (other than ISS)\n# MEO - Medium Earth Orbit\n# MOL - Molniya Orbit\n# MTO - MEO Transfer Orbit (payload performs MEO circularization)\n# SSO - Sun-Synchronous Orbit\n# STO - Supersynchronous Transfer Orbit (apogee > 45,000 km)\n# XO  - Extraterrestrial Launch (e.g., launch from lunar surface)\n\n\nroot datasource raw_launch_info (\n    Launch_Tag: launch_tag,\n    Launch_JD: launch_jd,\n    LV_Type: vehicle.name,\n    Variant: vehicle.variant,\n    Flight_ID: flight_id,\n    Flight: flight,\n    Mission: mission,\n    FlightCode: flight_code,\n    Platform: ?platform.code,\n    Launch_Site: ?site.key,\n    Launch_Pad: launch_pad,\n    Ascent_Site: ascent_site,\n    Ascent_Pad: ascent_pad,\n    Apogee: apogee,\n    Apoflag: ?apo_flag,\n    Range: ?range,\n    RangeFlag: ?range_flag,\n    Dest: dest,\n    OrbPay: orb_pay,\n    Agency: orgs,\n    LaunchCode: _launch_code,\n    FailCode: ?fail_code,\n    Category: category,\n    LTCite: lt_cite,\n    Cite: cite,\n    Notes: notes,\n    data_update_date: data_updated_through\n    )\ngrain (launch_tag)\nfile `ingest_launch.py`\nfreshness by data_updated_through;\n\ndatasource launch_info (\n    launch_tag,\n    launch_jd,\n    vehicle.name,\n    vehicle.variant,\n    flight_id,\n    flight,\n    mission,\n    flight_code,\n    ?platform.code,\n    ?site.key,\n    launch_pad,\n    ascent_site,\n    ascent_pad,\n    apogee,\n    ?apo_flag,\n    ?range,\n    ?range_flag,\n    dest,\n    orb_pay,\n    orgs,\n    org.code,\n    _launch_code,\n    ?fail_code,\n    launch_date,\n    category,\n    lt_cite,\n    cite,\n    notes,\n    data_updated_through\n    )\ngrain (launch_tag)\nfile `https://storage.googleapis.com/trilogy_public_models/duckdb/launch_report/launch.parquet`:`gcs://trilogy_public_models/duckdb/launch_report/launch.parquet`\nfreshness by data_updated_through;\n",
    "type": "preql"
  },
  {
    "id": "organization.preql",
    "name": "organization",
    "contents": "import std.geography;\nimport std.net;\nimport std.color;\nimport etl;\n\nkey code string;\nproperty code.u_code string;\nproperty code.state_code string; #OrgCode for organzation's host state.\nproperty code.type string;\nproperty code.class string; # Organization class: A, B, C, or D (Nonprofit, commercial, civil or defence)\nproperty code.t_start string;\nproperty code.t_stop string;\nproperty code.short_name string;\nproperty code.name string;\nproperty code.location string; # Approximate location (e.g. city)\nproperty code.longitude float;\nproperty code.latitude float;\nproperty code.error float;\nproperty code.parent string;\nproperty code.short_e_name string;\nproperty code._e_name string; #english name\nproperty code.u_name string;\nproperty flag <- CAST(CASE WHEN state_code in ('SU', 'RU') THEN 'https://upload.wikimedia.org/wikipedia/commons/5/53/Flag_of_the_Soviet_Union_%283-2%29.svg'\nWHEN state_code = 'US' THEN 'https://upload.wikimedia.org/wikipedia/commons/5/55/Flag_of_the_United_States_%283-2_aspect_ratio%29.svg'\nWHEN state_code = 'CN' THEN 'https://upload.wikimedia.org/wikipedia/commons/thumb/f/fa/Flag_of_the_People%27s_Republic_of_China.svg/2880px-Flag_of_the_People%27s_Republic_of_China.svg.png'\nELSE 'https://upload.wikimedia.org/wikipedia/commons/thumb/2/2f/Flag_of_the_United_Nations.svg/2880px-Flag_of_the_United_Nations.svg.png'\nEND AS string::url_image); # wikipedia flag image url; only for US/Russia/China for now\n\nproperty code.color <- \n  CASE\n     # Major powers\n    WHEN state_code = 'US' THEN '#4A6CFF'        # bright US blue\n    WHEN state_code IN ('SU', 'RU') THEN '#FF3B3B' # bright Soviet/Russia red\n    WHEN state_code = 'CN' THEN '#FF4D00'        # vivid China red-orange\n    WHEN state_code = 'IN' THEN '#2ECC71'        # bright India green\n    WHEN state_code = 'J' THEN '#FFFFFF'         # Japan white (pops on dark)\n    WHEN state_code = 'UK' THEN '#3B7CFF'        # lifted UK blue\n    WHEN state_code = 'F' THEN '#4DA3FF'         # bright France blue\n\n    # Europe\n    WHEN state_code IN ('D', 'DR', 'DD') THEN '#FFD84D' # luminous Germany gold\n    WHEN state_code = 'NL' THEN '#FFB347'        # bright Netherlands orange\n    WHEN state_code = 'E' THEN '#FFD23F'         # Spain yellow\n    WHEN state_code = 'I' THEN '#3DDB85'         # Italy green\n    WHEN state_code = 'PL' THEN '#FFFFFF'        # Poland white\n    WHEN state_code = 'GR' THEN '#4FC3FF'        # Greece light blue\n    WHEN state_code = 'N' THEN '#5FA8FF'         # Norway blue\n    WHEN state_code = 'S' THEN '#4DD2FF'         # Sweden cyan-blue\n    WHEN state_code = 'DK' THEN '#FF5C5C'        # Denmark bright red\n    WHEN state_code = 'CH' THEN '#FF3B3B'        # Switzerland red\n    WHEN state_code = 'UA' THEN '#FFE066'        # Ukraine yellow\n\n    # Americas\n    WHEN state_code = 'CA' THEN '#FF4D4D'        # Canada bright red\n    WHEN state_code = 'BR' THEN '#2ECC71'        # Brazil bright green\n    WHEN state_code = 'AR' THEN '#7FDBFF'        # Argentina sky blue\n\n    # Middle East / Africa\n    WHEN state_code = 'IR' THEN '#2ECC71'        # Iran green\n    WHEN state_code = 'IQ' THEN '#FFFFFF'        # Iraq white (avoid black)\n    WHEN state_code = 'IL' THEN '#4DA3FF'        # Israel blue\n    WHEN state_code = 'EG' THEN '#FFFFFF'        # Egypt white\n    WHEN state_code = 'TR' THEN '#FF3B3B'        # Turkey red\n    WHEN state_code = 'SY' THEN '#FFFFFF'        # Syria white\n    WHEN state_code = 'LY' THEN '#3DDB85'        # Libya green\n    WHEN state_code = 'ZA' THEN '#2ECC71'        # South Africa green\n    WHEN state_code = 'OM' THEN '#FFFFFF'        # Oman white\n    WHEN state_code = 'LB' THEN '#3DDB85'        # Lebanon green\n    WHEN state_code = 'YE' THEN '#FFFFFF'        # Yemen white\n\n    # Asia-Pacific\n    WHEN state_code = 'KP' THEN '#FF5C5C'        # North Korea red\n    WHEN state_code = 'KR' THEN '#4DA3FF'        # South Korea blue\n    WHEN state_code = 'PK' THEN '#2ECC71'        # Pakistan green\n    WHEN state_code = 'ID' THEN '#FFFFFF'        # Indonesia white\n    WHEN state_code = 'TW' THEN '#4A6CFF'        # Taiwan blue\n    WHEN state_code = 'AU' THEN '#4A6CFF'        # Australia blue\n    WHEN state_code = 'NZ' THEN '#4A6CFF'        # New Zealand blue\n\n    # Space / supranational\n    WHEN state_code IN ('I-ESA', 'I-ESRO', 'I-ELDO') THEN '#4FC3FF' # ESA bright blue\n    WHEN state_code = 'CYM' THEN '#4A6CFF'       # UK blue (BOT)\n\n    # Unknown / placeholder\n    WHEN state_code = 'X' THEN '#7FB7FF'          # UN light blue\n\n    ELSE '#7FB7FF'\n  END::string::hex; # a representative hex code\n\n\nauto e_name <- coalesce(CASE WHEN _e_name = '-' then NULL else _e_name end, u_name); # the default English name of an \"organization\" - a company, state, or other body. Examples \"European Space Agency\", \"US Air Force Space and Missile Center\", \"Beijing Interstellar Glory Space Tech. Co. Ltd.\" Best search with wildcards; abbreviations typically expanded.\n\n\nroot datasource organizations_raw (\n    Code: code,\n    UCode: u_code,\n    StateCode: state_code,\n    Type: type,\n    Class: class,\n    TStart: t_start,\n    TStop: t_stop,\n    ShortName: short_name,\n    Name: name,\n    Location: location,\n    Longitude: ?longitude,\n    Latitude: ?latitude,\n    Error: error,\n    Parent: parent,\n    ShortEName: short_e_name,\n    EName: ?_e_name,\n    UName: u_name,\n    data_update_date: data_updated_through\n    )\ngrain (code)\nfile `ingest_orgs.py`\nfreshness by data_updated_through;\n\n\ndatasource organizations (\n    code,\n    u_code,\n    state_code,\n    type,\n    class,\n    t_start,\n    t_stop,\n    short_name,\n    name,\n    location,\n    ?longitude,\n    ?latitude,\n    error,\n    parent,\n    short_e_name,\n    ?_e_name,\n    u_name,\n    data_updated_through,\n    color\n    )\ngrain (code)\nfile `https://storage.googleapis.com/trilogy_public_models/duckdb/launch_report/organizations.parquet`:`gcs://trilogy_public_models/duckdb/launch_report/organizations.parquet`\nfreshness by data_updated_through;\n",
    "type": "preql"
  },
  {
    "id": "platform.preql",
    "name": "platform",
    "contents": "import std.geography;\nimport etl;\n\nkey code string; # the code of a launch platform. A platform is a mobile structures which don't have a fixed geographical location. Most launches are from sites, not platforms.\nproperty code.u_code string;\nproperty code.state_code string::country_code;\nproperty code.type string;\nproperty code.class string;\nproperty code.t_start string;\nproperty code.t_stop string;\nproperty code.short_name string;\nproperty code.name string;\nproperty code.location string;\n# these are all null\n# excluding from model for the moment\n# property code.longitude float::longitude;\n# property code.latitude float::latitude;\nproperty code.error float;\nproperty code.parent string;\nproperty code.short_e_name string;\nproperty code.e_name string;\nproperty code.v_class string;\nproperty code.v_class_id string;\nproperty code.v_id string;\nproperty code.u_name string;\n\n\nroot datasource platform_info_raw (\n    Code: code,\n    UCode: u_code,\n    StateCode: state_code,\n    Type: type,\n    Class: class,\n    TStart: t_start,\n    TStop: t_stop,\n    ShortName: short_name,\n    Name: name,\n    Location: location,\n    # Longitude: longitude,\n    # Latitude: latitude,\n    Error: ?error,\n    Parent: parent,\n    ShortEName: short_e_name,\n    EName: e_name,\n    VClass: v_class,\n    VClassID: v_class_id,\n    VID: v_id,\n    UName: u_name,\n    data_update_date: data_updated_through\n    )\ngrain (code)\nfile `ingest_platform.py`\nfreshness by data_updated_through;\n\n\ndatasource platform_info (\n    code,\n    u_code,\n    state_code,\n    type,\n    class,\n    t_start,\n    t_stop,\n    short_name,\n    name,\n    location,\n    ?error,\n    parent,\n    short_e_name,\n    e_name,\n    v_class,\n    v_class_id,\n    v_id,\n    u_name,\n    data_updated_through\n    )\ngrain (code)\nfile `https://storage.googleapis.com/trilogy_public_models/duckdb/launch_report/platform_info.parquet`:`gcs://trilogy_public_models/duckdb/launch_report/platform_info.parquet`\nfreshness by data_updated_through;\n",
    "type": "preql"
  },
  {
    "id": "satellite.preql",
    "name": "satellite",
    "contents": "import etl;\nimport organization as manufacturer;\nimport organization as owner;\nimport organization as state;\nimport launch as launch;\n\n\n#auto-generated datasource from table/view satcat\nkey jcat string; # Alphanumeric identifier to uniquely tag space objects, consisting of a prefix letter and a sequence number.\nproperty jcat.satcat string; # Corresponds to the US SATCAT number; an integer value or a descriptive string if not present in SATCAT.\n\nproperty jcat._launch_date string;\nproperty jcat._decom_date string;\n\nproperty jcat.launch_date <- @extract_date(_launch_date);\nproperty jcat.decom_date <- @extract_date(_decom_date);\n\nproperty jcat.piece string; # Piece designation for the object; often matches the Launch Tag.\nproperty jcat.type string; # Contains SatType string; characterizes the object (P for payload, R for rocket stage, etc.).\nproperty jcat.name string; # Recommended name based on that used by owner/operator; represents an objects name.\nproperty jcat.pl_name string; # An alternative name for the object; may indicate radar cross section or unidentified debris.\n\nproperty jcat.parent string; # Parent object or central body the object is attached to at the start of a phase.\nproperty jcat.s_date string; # Separation Date; start time for the current phase in UTC.\nproperty jcat.primary string; # Central body for the current phase; usually Earth.\n\nproperty jcat.status string; # Event that ends the current phase.\nproperty jcat.dest string; # Destination of the current phase, could be a reentry location or JCAT identifier of a new parent.\n# property jcat.state string; # OrgCode for the country/state of the owner/operator.\n\nkey bus string; # Spacecraft bus type; indicates chassis type or standardization.\nproperty jcat.motor string; # Name of the main thruster or rocket engine; details may be in Engines file.\nproperty jcat.mass float; # Mass in kg at launch, excluding attached objects; identified if the mass is an estimate.\nproperty jcat.mass_flag string; # Indicates estimation in mass; '?' implies estimate, accurate to about 20%.\nproperty jcat.dry_mass float; # Dry mass in kg; proxy for object's mass post active life, not including attached objects.\nproperty jcat.dry_flag string; # Indicates dry mass estimation; '?' imply it's an estimation.\nproperty jcat.tot_mass float; # Total mass in kg at launch; for attached GCAT objects, sum should equate to TotMass.\nproperty jcat.tot_flag string; # Indicates estimation of total mass; '?' symbolizes estimation.\nproperty jcat.length float; # Longest dimension in metres; if '?', it's a guess within ~20% accuracy.\nproperty jcat.l_flag string; # Estimation indicator for length; '?' depicts estimation.\nproperty jcat.diameter float; # Second longest dimension; often second-longest dimension for cross-sectional approximation.\nproperty jcat.d_flag string; # Diameter estimation indication; '?' signifies guessed measure.\nproperty jcat.span float; # Largest dimension including all appendages, in metres; stay outside a sphere of Span diameter.\nproperty jcat.span_flag string; # Span estimation; '?' indicates a guess within ~20% accuracy.\nproperty jcat.shape string; # Approximate shape description; not a substitute for a CAD model.\nproperty jcat.o_date string; # Orbit Epoch Date; date format for canonical orbital data.\nproperty jcat.perigee int; # Perigee height in km of canonical orbit; if '?', value is estimated.\nproperty jcat.pf string; # Indicator if the perigee is a guess; uses '?' to symbolize.\nproperty jcat.apogee float; # Apogee height in km; if '?', it\u2019s an estimate.\nproperty jcat.af string; # Apogee guess indicator; '?' meaning estimation.\nproperty jcat.inc float; # Inclination of orbit in degrees; if '?', signifies estimation.\nproperty jcat.if string; # Orbit inclination estimation; '?' means it's an estimation.\nproperty jcat.op_orbit string; # Orbit type of the canonical orbit.\nproperty jcat.oqual string; # Orbit Quality Note; where the orbit data was sourced from.\nproperty jcat.alt_names string; # Comma-delimited list of alternative names for the space object.\n\n\nauto base_category <- substring(split(type, ' ')[1],1,1); #P\tPayload (for orbital attempt)\n#C\tComponent\n#R\tLaunch vehicle stage\n#D\tFragmentation debris\n#S\tSuborbital payload (e.g. sounding rocket payload or missile reentry vehicle)\n#X\tCatalog entry that has been deleted (used in auxcat etc.)\n#Z\tSpurious catalog entry (was in SATCAT, perhaps in TLEs, but there was no real object)\n\nproperty jcat.is_decommed <- decom_date is not null; # if a satellite has been decommissioned as of latest data update. Use decom date to filter by what was active a historicp oint.\n\n\nroot datasource satcat_raw (\n    JCAT: jcat,\n    Satcat: satcat,\n    Launch_Tag: launch.launch_tag,\n    Piece: piece,\n    Type: type,\n    Name: name,\n    PLName: pl_name,\n    LDate: ?_launch_date,\n    Parent: parent,\n    SDate: s_date,\n    Primary: primary,\n    DDate: ?_decom_date,\n    Status: status,\n    Dest: dest,\n    Owner: owner.code,\n    State: state.code,\n    Manufacturer: manufacturer.code,\n    Bus: bus,\n    Motor: motor,\n    Mass: mass,\n    MassFlag: ?mass_flag,\n    DryMass: dry_mass,\n    DryFlag: ?dry_flag,\n    TotMass: tot_mass,\n    TotFlag: ?tot_flag,\n    Length: length,\n    LFlag: ?l_flag,\n    Diameter: diameter,\n    DFlag: ?d_flag,\n    Span: span,\n    SpanFlag: ?span_flag,\n    Shape: shape,\n    ODate: o_date,\n    Perigee: perigee,\n    PF: ?pf,\n    Apogee: apogee,\n    AF: ?af,\n    Inc: inc,\n    IF: ?if,\n    OpOrbit: op_orbit,\n    OQUAL: oqual,\n    AltNames: alt_names,\n    data_update_date: data_updated_through\n    )\ngrain (jcat)\nfile `ingest_satcat.py`\nfreshness by data_updated_through;\n\n\ndatasource satcat (\n    JCAT: jcat,\n    Satcat: satcat,\n    Launch_Tag: launch.launch_tag,\n    Piece: piece,\n    Type: type,\n    Name: name,\n    PLName: pl_name,\n    LDate: ?launch_date,\n    Parent: parent,\n    SDate: s_date,\n    Primary: primary,\n    DDate: ?decom_date,\n    Status: status,\n    Dest: dest,\n    Owner: owner.code,\n    State: state.code,\n    Manufacturer: manufacturer.code,\n    Bus: bus,\n    Motor: motor,\n    Mass: mass,\n    MassFlag: ?mass_flag,\n    DryMass: dry_mass,\n    DryFlag: ?dry_flag,\n    TotMass: tot_mass,\n    TotFlag: ?tot_flag,\n    Length: length,\n    LFlag: ?l_flag,\n    Diameter: diameter,\n    DFlag: ?d_flag,\n    Span: span,\n    SpanFlag: ?span_flag,\n    Shape: shape,\n    ODate: o_date,\n    Perigee: perigee,\n    PF: ?pf,\n    Apogee: apogee,\n    AF: ?af,\n    Inc: inc,\n    IF: ?if,\n    OpOrbit: op_orbit,\n    OQUAL: oqual,\n    AltNames: alt_names,\n    data_update_date: data_updated_through\n    )\ngrain (jcat)\nfile `https://storage.googleapis.com/trilogy_public_models/duckdb/launch_report/satcat.parquet`:`gcs://trilogy_public_models/duckdb/launch_report/satcat.parquet`\nfreshness by data_updated_through;\n",
    "type": "preql"
  },
  {
    "id": "sites.preql",
    "name": "sites",
    "contents": "import std.geography;\nimport etl;\n\nkey key string; # the code of a launch site. A launch site is a fixed geographical location from which launches occur. Most launches are from sites, not platforms. Platforms which have been used to launch rockets include surface ships, submarines and aircraft.  \nproperty key.code string;\nproperty key.u_code string;\nproperty key.type string;\nkey state_code string;\nproperty key.t_start string;\nproperty key.t_stop string;\nproperty key.short_name string;\nproperty key.name string;\nproperty key.location string;\nproperty key.longitude float::longitude;\nproperty key.latitude float::latitude;\nproperty key.error float;\nproperty key.parent string;\nproperty key.e_name string;\nproperty key.u_name string;\n\nroot datasource sites_raw (\n    Site: key,\n    Code: code,\n    UCode: u_code,\n    Type: type,\n    StateCode: state_code,\n    TStart: t_start,\n    TStop: t_stop,\n    ShortName: short_name,\n    Name: name,\n    Location: location,\n    longitude: ?longitude,\n    latitude: ?latitude,\n    Error: error,\n    Parent: parent,\n    EName: e_name,\n    UName: u_name,\n    data_update_date: data_updated_through\n    )\ngrain (key)\nfile `ingest_sites.py`\nfreshness by data_updated_through;\n\n\ndatasource sites (\n    key,\n    code,\n    u_code,\n    type,\n    state_code,\n    t_start,\n    t_stop,\n    short_name,\n    name,\n    location,\n    ?longitude,\n    ?latitude,\n    error,\n    parent,\n    e_name,\n    u_name,\n    data_updated_through\n    )\ngrain (key)\nfile `https://storage.googleapis.com/trilogy_public_models/duckdb/launch_report/sites.parquet`:`gcs://trilogy_public_models/duckdb/launch_report/sites.parquet`\nfreshness by data_updated_through;\n",
    "type": "preql"
  },
  {
    "id": "stage.preql",
    "name": "stage",
    "contents": "import std.metric;\nimport std.date;\nimport engine as engine;\nimport etl;\n\nkey name string;\nproperty name.family string;\nproperty name.stage_manufacturer string;\nproperty name.stage_alt_name string;\nproperty name.length numeric::m;\nproperty name.diameter numeric::m;\nproperty name.launch_mass numeric::tonne;\nproperty name.dry_mass numeric::kg;\nproperty name.thrust numeric::kn;\nproperty name.duration numeric::second;\nproperty name.engine_count int;\n\n\nroot datasource stages_raw (\n    Stage_Name: name,\n    Stage_Family: family,\n    Stage_Manufacturer: stage_manufacturer,\n    Stage_Alt_Name: stage_alt_name,\n    Length: ?length,\n    Diameter: ?diameter,\n    Launch_Mass: ?launch_mass,\n    Dry_Mass: ?dry_mass,\n    Thrust: ?thrust,\n    Duration: ?duration,\n    Engine: ~engine.name,\n    NEng: ?engine_count,\n    data_update_date: data_updated_through\n    )\ngrain (name)\nfile `ingest_stages.py`\nfreshness by data_updated_through;\n\n\ndatasource stages (\n    name,\n    family,\n    stage_manufacturer,\n    stage_alt_name,\n    ?length,\n    ?diameter,\n    ?launch_mass,\n    ?dry_mass,\n    ?thrust,\n    ?duration,\n    ~engine.name,\n    ?engine_count,\n    data_updated_through\n    )\ngrain (name)\nfile `https://storage.googleapis.com/trilogy_public_models/duckdb/launch_report/stages.parquet`:`gcs://trilogy_public_models/duckdb/launch_report/stages.parquet`\nfreshness by data_updated_through;\n",
    "type": "preql"
  },
  {
    "id": "vehicle.preql",
    "name": "vehicle",
    "contents": "#auto-generated datasource from table/view lv_info\nimport stage as stage;\nimport etl;\n\nkey name string;\nkey variant string;\nproperty <name,variant>.family string;\nproperty <name,variant>.manufacturer string;\nproperty <name,variant>.alias string;\nproperty <name,variant>.min_stage int;\nproperty <name,variant>.max_stage int;\nproperty <name,variant>.length float;\nproperty <name,variant>.lflag string;\nproperty <name,variant>.diameter float;\nproperty <name,variant>.dflag string;\nproperty <name,variant>.launch_mass float;\nproperty <name,variant>.mflag string;\nproperty <name,variant>.leo_capacity float;\nproperty <name,variant>.gto_capacity float;\nproperty <name,variant>.to_thrust int;\nproperty <name,variant>.class string;\nproperty <name,variant>.apogee int;\nproperty <name,variant>.range int;\nproperty class_name <- CASE\n\tWHEN class = 'D' THEN 'Deep Space'\n\tWHEN class = 'M' THEN 'Missile'\n\tWHEN class = 'O' THEN 'Orbital'\n\tWHEN class = 'R' THEN 'Research'\n\tWHEN class = 'V' THEN 'Reentry Test'\n\tWHEN class = 'X' THEN 'Exoatmospheric Test'\n\tWHEN class = 'Y' THEN 'Exoatmospheric Weather'\n\tWHEN class = 'A' THEN 'Endoatmospheric Missile'\n\tWHEN class = 'C' THEN 'Cruise Missile'\n\tWHEN class = 'Q' THEN 'Endoatmospheric reentry test'\n\tWHEN class = 'T' THEN 'Endoatmospheric test/research'\n\tWHEN class = 'W' THEN 'Endoatmospheric weather rocket'\n\tELSE 'Unknown'\nEND;\nproperty full_name <- CASE\n\tWHEN variant != '-' THEN concat(name,' ',variant)\n\tELSE name\nEND;\n\n\nroot datasource lv_info_raw (\n    LV_Name: name,\n    LV_Family: family,\n    LV_Manufacturer: manufacturer,\n    LV_Variant: variant,\n    LV_Alias: alias,\n    LV_Min_Stage: min_stage,\n    LV_Max_Stage: max_stage,\n    Length: ?length,\n    LFlag: ?lflag,\n    Diameter: diameter,\n    DFlag: ?dflag,\n    Launch_Mass: ?launch_mass,\n    MFlag: ?mflag,\n    LEO_Capacity: ?leo_capacity,\n    GTO_Capacity: ?gto_capacity,\n    TO_Thrust: ?to_thrust,\n    Class: class,\n    Apogee: ?apogee,\n    Range: ?range,\n    data_update_date: data_updated_through\n    )\ngrain (name,variant)\nfile `ingest_vehicle.py`\nfreshness by data_updated_through;\n\n\ndatasource lv_info (\n    name,\n    family,\n    manufacturer,\n    variant,\n    alias,\n    min_stage,\n    max_stage,\n    ?length,\n    ?lflag,\n    diameter,\n    ?dflag,\n    ?launch_mass,\n    ?mflag,\n    ?leo_capacity,\n    ?gto_capacity,\n    ?to_thrust,\n    class,\n    ?apogee,\n    ?range,\n    data_updated_through\n    )\ngrain (name,variant)\nfile `https://storage.googleapis.com/trilogy_public_models/duckdb/launch_report/lv_info.parquet`:`gcs://trilogy_public_models/duckdb/launch_report/lv_info.parquet`\nfreshness by data_updated_through;\n\n\nkey stage_no string; # (which can be -1 or 0 for strapons, and F for fairing)\nproperty <name,stage_no,variant>.qualifier string;\nproperty <name,stage_no,variant>.dummy string; # a flag to indicate a dummy stage (e.g. the Cora vehicle always carries a dummy Astris stage)\nproperty <name,stage_no,variant>.multiplicity int; # e.g. stage 0 of the ASLV consists of two AS-0 strapon stages, and so has multiplicity 2.\nproperty <name,stage_no,variant>.stage_impulse float;\nproperty <name,stage_no,variant>.stage_apogee int;\nproperty <name,stage_no,variant>.stage_perigee int;\nproperty <name,stage_no,variant>.perigee_qual string;\n\n\nroot datasource lvs_info_raw (\n    LV_Name: name,\n    LV_Variant: variant,\n    Stage_No: stage_no,\n    Stage_Name: ~stage.name,\n    Qualifier: qualifier,\n    Dummy: dummy,\n    Multiplicity: multiplicity,\n    Stage_Impulse: ?stage_impulse,\n    Stage_Apogee: stage_apogee,\n    Stage_Perigee: stage_perigee,\n    Perigee_Qual: perigee_qual,\n    data_update_date: data_updated_through\n    )\ngrain (name,stage_no,variant)\nfile `ingest_vehicle_stages.py`\nfreshness by data_updated_through;\n\n\ndatasource lvs_info (\n    name,\n    variant,\n    stage_no,\n    ~stage.name,\n    qualifier,\n    dummy,\n    multiplicity,\n    ?stage_impulse,\n    stage_apogee,\n    stage_perigee,\n    perigee_qual,\n    data_updated_through\n    )\ngrain (name,stage_no,variant)\nfile `https://storage.googleapis.com/trilogy_public_models/duckdb/launch_report/lvs_info.parquet`:`gcs://trilogy_public_models/duckdb/launch_report/lvs_info.parquet`\nfreshness by data_updated_through;\n",
    "type": "preql"
  }
]